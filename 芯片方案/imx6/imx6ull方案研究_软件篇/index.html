<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.8.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="嵌入式开发"><title>i.MX 6ULL研究笔记_软件篇 | wzhchen's blog</title><link rel="stylesheet" type="text/css" href="//fonts.neworld.org/css?family=Source+Code+Pro"><link rel="stylesheet" type="text/css" href="/css/style.css?v=2.0.1"><link rel="stylesheet" type="text/css" href="/css/highlight.css?v=2.0.1"><link rel="Shortcut Icon" href="/favicon.ico"><link rel="bookmark" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">i.MX 6ULL研究笔记_软件篇</h1><a id="logo" href="/.">wzhchen's blog</a><p class="description">学习、记录、分享</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div><div id="search-form"><div id="result-mask" class="hide"></div><label><input id="search-key" type="text" autocomplete="off" placeholder="Arama"></label><div id="result-wrap" class="hide"><div id="search-result"></div></div><div class="hide"><template id="search-tpl"><div class="item"><a href="/{path}" title="{title}"><div class="title">{title}</div><div class="time">{date}</div><div class="tags">{tags}</div></a></div></template></div></div></div><div id="layout" class="layout-g"><div class="layout-l"><div class="content_container"><div class="post"><h1 class="post-title">i.MX 6ULL研究笔记_软件篇</h1><div class="post-meta"><a href="/芯片方案/imx6/imx6ull方案研究_软件篇/#comments" class="comment-count"></a><p><span class="date">Jan 18, 2018</span><span><a href="/categories/芯片方案/" class="category">芯片方案</a></span><span><i id="busuanzi_container_page_pv"><i id="busuanzi_value_page_pv"></i><i>点击</i></i></span></p></div><div class="post-content"><p>主篇文章主要记录imx6的研究过程，将工作中有的到的重要部分提炼出来，主要描述与软件相关的内容。</p>
<p>相关文章：<a href="/芯片方案/imx6/imx6ull方案研究_硬件篇/" title="i.MX 6ULL研究笔记_硬件篇">i.MX 6ULL研究笔记_硬件篇</a></p>
<a id="more"></a>
<h1 id="搭建编译工程"><a href="#搭建编译工程" class="headerlink" title="搭建编译工程"></a>搭建编译工程</h1><p>i.mx6官方提供的软件开发指导是基于yocto工程，文档中包含了许多内容，比如：</p>
<ul>
<li>指导如何配置主机（需要安装哪些包）；</li>
<li>指导如何下载yocto工程（不包含实际代码）；</li>
<li>如果配置编译，执行编译（编译过程中下载代码）；</li>
<li>……</li>
</ul>
<p>yocto开发模式的优点：</p>
<ul>
<li>编译工程也集成非常多的软、硬件支持；</li>
<li>可编译出各种类型的系统（虚拟系统、带图形界面系统、PC系统等待）；</li>
</ul>
<p>yocto开发模式的缺点：</p>
<ul>
<li>对开发者要求比较高；</li>
<li>编译执行速度非常慢；</li>
<li>编译出错不容易定位；</li>
</ul>
<p>结合实际情况，我们不选yocto开发模式，自己搭建编译工程</p>
<h2 id="源码获取"><a href="#源码获取" class="headerlink" title="源码获取"></a>源码获取</h2><p>自己搭建编译工程需要单独下载源码<br>fresscale的代码存放在<a href="http://git.freescale.com/git" target="_blank" rel="noopener">http://git.freescale.com/git</a></p>
<p>根据yocto指导手册可以找到i.MX6ULL需要代码<br>kernel：<a href="git://git.freescale.com/imx/uboot-imx.git" target="_blank" rel="noopener">git://git.freescale.com/imx/uboot-imx.git</a><br>​       branch：imx_4.1.15_2.0.0_ga（最新的是imx_4.9.11_1.0.0_ga）<br>uboot：<a href="git://git.freescale.com/imx/uboot-imx.git" target="_blank" rel="noopener">git://git.freescale.com/imx/uboot-imx.git</a><br>​       branch：imx_v2016.03_4.1.15_2.0.0_ga（最新的是imx_v2017.03_4.9.11_1.0.0_ga）</p>
<h2 id="工具链获取"><a href="#工具链获取" class="headerlink" title="工具链获取"></a>工具链获取</h2><p>自己搭建编译工程需要单独下载工具链，可以从<a href="https://releases.linaro.org/components/toolchain/binaries/" target="_blank" rel="noopener">linaro官网</a>下载，根据需求选择正确的工具链</p>
<h1 id="编译-amp-移植"><a href="#编译-amp-移植" class="headerlink" title="编译&amp;移植"></a>编译&amp;移植</h1><h2 id="uboot编译-amp-移植"><a href="#uboot编译-amp-移植" class="headerlink" title="uboot编译&amp;移植"></a>uboot编译&amp;移植</h2><ol>
<li>官方代码提供了几多板型支持，根据实际情况选择最接近的一个，拷贝一份（有多个文件），命名为hd_mx6ull_ddr3</li>
<li>在uboot根目录下执行make hd_mx6ull_ddr3_defconfig生成原始配置；</li>
<li>根据实际硬件及需求进行调试代码；</li>
<li><p>将编译生成-boot.imx文件拷贝到目标位置；</p>
<p><em>注：编译前需要配置好工具链</em></p>
</li>
</ol>
<h2 id="kernel编译-amp-移植"><a href="#kernel编译-amp-移植" class="headerlink" title="kernel编译&amp;移植"></a>kernel编译&amp;移植</h2><ol>
<li>官方代码提供了几多板型支持，根据实际情况选择最接近的一个拷贝命令名为imx6ull-14x14-hd.dts，同时添加对imx6ull-14x14-hd.dts的编译控制； </li>
<li>在kernel根目录下执行make ARCH=arm imx_v7_defconfig生成原始配置；</li>
<li>执行make menuconfig，根据实现硬件及需求进行配置； </li>
<li>根据实际硬件及需求进行调试代码； </li>
<li><p>将编译生成的zImage和imx6ull-14x14-hd.dtb 文件拷贝到目标位置； </p>
<p><em>注：编译前需要配置好工具链和ARCH</em></p>
</li>
</ol>
<h2 id="rootfs编译"><a href="#rootfs编译" class="headerlink" title="rootfs编译"></a>rootfs编译</h2><p>可以使用ubuntu core作为文件系统，直接从ubuntu 官网下载，然后再根据具体需求进行增减功能</p>
<p>ububtu core可以从官网下载：<a href="http://old-releases.ubuntu.com/releases/ubuntu-core/releases" target="_blank" rel="noopener">http://old-releases.ubuntu.com/releases/ubuntu-core/releases</a></p>
<h1 id="CPU超频方法"><a href="#CPU超频方法" class="headerlink" title="CPU超频方法"></a>CPU超频方法</h1><ol>
<li><p>设备树operating-points</p>
<p>CPU可工作的频率由设备树的operating-points决定，目前的设备树</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">operating-points = &lt;</span><br><span class="line">	/* kHz	uV */</span><br><span class="line">	996000	1275000</span><br><span class="line">	792000	1225000</span><br><span class="line">	528000	1175000</span><br><span class="line">	396000	1025000</span><br><span class="line">	198000	950000</span><br><span class="line">&gt;;</span><br></pre></td></tr></table></figure>
<p>从设备树来看，没有做限制（<em>当然也可以自己修改来限制最高运行频率，不过应该没人这么干</em>）<br>既然设备树里没有限制，那就应该是代码中识别了CPU的型号，取消了其中某些选项</p>
</li>
<li><p>查找代码</p>
<p>最终定位到mach-imx6ull.c文件</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">void</span> __<span class="function">init <span class="title">imx6ul_opp_check_speed_grading</span><span class="params">(struct device *cpu_dev)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">     ……</span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * Speed GRADING[1:0] defines the max speed of ARM:</span></span><br><span class="line"><span class="comment">	 * 2b'00: Reserved;</span></span><br><span class="line"><span class="comment">	 * 2b'01: 528000000Hz;</span></span><br><span class="line"><span class="comment">	 * 2b'10: 700000000Hz(i.MX6UL), 800000000Hz(i.MX6ULL);</span></span><br><span class="line"><span class="comment">	 * 2b'11: Reserved(i.MX6UL), 1GHz(i.MX6ULL);</span></span><br><span class="line"><span class="comment">	 * We need to set the max speed of ARM according to fuse map.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	val = readl_relaxed(base + OCOTP_CFG3);</span><br><span class="line">	val &gt;&gt;= OCOTP_CFG3_SPEED_SHIFT;</span><br><span class="line">	val &amp;= <span class="number">0x3</span>;</span><br><span class="line">	<span class="keyword">if</span> (cpu_is_imx6ul()) &#123;</span><br><span class="line">		<span class="keyword">if</span> (val &lt; OCOTP_CFG3_SPEED_696MHZ) &#123;</span><br><span class="line">			<span class="keyword">if</span> (dev_pm_opp_disable(cpu_dev, <span class="number">696000000</span>))</span><br><span class="line">				pr_warn(<span class="string">"Failed to disable 696MHz OPP\n"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (cpu_is_imx6ull()) &#123;</span><br><span class="line">		<span class="keyword">if</span> (val != OCOTP_CFG3_SPEED_1_GHZ) &#123; <span class="comment">//将这几行屏蔽可超频到996Mhz</span></span><br><span class="line">			<span class="keyword">if</span> (dev_pm_opp_disable(cpu_dev, <span class="number">996000000</span>))</span><br><span class="line">				pr_warn(<span class="string">"Failed to disable 996MHz OPP\n"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (val != OCOTP_CFG3_SPEED_696MHZ) &#123; <span class="comment">//将这几行屏蔽可超频到792Mhz</span></span><br><span class="line">			<span class="keyword">if</span> (dev_pm_opp_disable(cpu_dev, <span class="number">792000000</span>))</span><br><span class="line">				pr_warn(<span class="string">"Failed to disable 792MHz OPP\n"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	iounmap(base);</span><br><span class="line"></span><br><span class="line">put_node:</span><br><span class="line">	of_node_put(np);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>通过分析代码可知，读取OCOTP_CFG3寄存器来判断是否要屏蔽掉某些工作频率，datasheet中关于OCOTP_CFG3的描述</p>
<img src="/芯片方案/imx6/imx6ull方案研究_软件篇/imx6ull主频配置.png">
<p><em>注：提升主频相应的VDD_SOC_IN也要提升，否则可能不稳定</em></p>
</li>
</ol>
<h2 id="实测"><a href="#实测" class="headerlink" title="实测"></a>实测</h2><p>   目前开发板使用的CPU标称频率是528Mhz，通过修改代码超频到792Mhz，进行对比测试（使用浮点运行、双精度浮点运算、整形运行3种模式运行对比测试）：</p>
<p>   <strong>从5128Hhz超频到792Mhz，CPU计算性能提升50%，主频提升成正比关系</strong></p>
<p>   几点说明：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1. 超频后CPU 100%运行，CPU温度没有明显变化（手摸没有明显发热）；</span><br><span class="line">2. 次测试在开发板上执行，超频后没有做稳定性挂机测试；</span><br><span class="line">3. 发板上VDD_SOC_IN电压只有1.2V，理论上是不够的，但测试时没发现问题；</span><br><span class="line">4. 代码中792Mhz对应的ARM电压是1.225V，因为VDD_SOC_IN不够，实测只有1.19V；</span><br></pre></td></tr></table></figure>
<h1 id="内存配置"><a href="#内存配置" class="headerlink" title="内存配置"></a>内存配置</h1><p>内存配置涉及到以下3部分：</p>
<ul>
<li>内存配置参数</li>
<li>内存参数校准</li>
<li>内存大小自适应</li>
</ul>
<h2 id="内存配置参数"><a href="#内存配置参数" class="headerlink" title="内存配置参数"></a>内存配置参数</h2><p>内存参数的配置在uboot/board/freescale/xxx/imximage.cfg  (xxx是板子名，目前是hd_mx6ull_ddr3)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">DATA 4 0x020c4068 0xffffffff</span><br><span class="line">DATA 4 0x020c406c 0xffffffff</span><br><span class="line">DATA 4 0x020c4070 0xffffffff</span><br><span class="line">DATA 4 0x020c4074 0xffffffff</span><br><span class="line">DATA 4 0x020c4078 0xffffffff</span><br><span class="line">DATA 4 0x020c407c 0xffffffff</span><br><span class="line">DATA 4 0x020c4080 0xffffffff</span><br><span class="line"></span><br><span class="line">DATA 4 0x020E04B4 0x000C0000</span><br><span class="line">DATA 4 0x020E04AC 0x00000000</span><br><span class="line">DATA 4 0x020E027C 0x00000030</span><br><span class="line">DATA 4 0x020E0250 0x00000030</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>这些东西，是什么意思呢？不在这里讲，这里只讲这些数据怎么得到</p>
<ol>
<li><p>下载DDR配置脚本文件（1个excel文件），点击<a href="https://community.nxp.com/servlet/JiveServlet/download/329899-3-378909/I.MX6UL_DDR3_Script_Aid_V0.02.xlsx" target="_blank" rel="noopener">这里</a>下载，也可以进入<a href="https://community.nxp.com/" target="_blank" rel="noopener">NXP的官方社区</a>搜索下载</p>
<p>根据实际使用的内存参数（需要查看内存芯片手册）进行配置，详细的说明文档点击<a href="https://community.nxp.com/servlet/JiveServlet/download/101708-1-278514/Freescale%20i.MX6%20DRAM%20Port%20Application%20Guide-DDR3.pdf" target="_blank" rel="noopener">这里</a>可以下载</p>
<img src="/芯片方案/imx6/imx6ull方案研究_软件篇/DDR配置.png">
</li>
<li><p>将excel文件中的RealView.inc表格里的文件复位出来，创建一个文本文件（文件名随便取，后缀为inc，比如取名：imx6ull_hd_ddr3.inc），到此，已经得到一份基础的配置文件，不过如下图所示，基础配置文件中有几项红色的需要校准</p>
<img src="/芯片方案/imx6/imx6ull方案研究_软件篇/DDR基础配置需要校准.png">
</li>
</ol>
<h2 id="内存参数校准"><a href="#内存参数校准" class="headerlink" title="内存参数校准"></a>内存参数校准</h2><p>内存参数校准目的：摘自官网论坛</p>
<blockquote>
<p>It performs write leveling, DQS gating, read/write delay calibration on the target board to match the layout of the board and archive the best DDR performance. </p>
</blockquote>
<p>说明校准与PCB设计相关</p>
<ol>
<li><p>修改基础的配置文件，将Disable WDOG屏蔽，具体修改如下</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">wait = on			</span><br><span class="line"><span class="comment">//=============================================================================			</span></span><br><span class="line"><span class="comment">// Disable	WDOG		</span></span><br><span class="line"><span class="comment">//=============================================================================			</span></span><br><span class="line"><span class="comment">//setmem /16	0x020bc000 =	0x30	//将一行屏蔽</span></span><br></pre></td></tr></table></figure>
<p>修改原因（官网论坛有描述）</p>
<blockquote>
<p>Q. I see an error message that states “ERROR: DCD addr is out of valid range.”, why is this and how do I resolve?</p>
<p> A. Sometimes, when using the register programming aid, there are registers writes that are not supported in the DCD range.  Try looking for the following items and comment them out from the DDR initialization script:<br>wait = on<br>setmem /16 0x020bc000 = 0x30 // disable watchdog (note the address for this may be different between i.MX6x devices)</p>
</blockquote>
</li>
<li><p>根据实际的硬件校准参数，需要下载校准工具，目前最新版本2.7.0，点击<a href="https://community.nxp.com/servlet/JiveServlet/download/339593-1-418920/ddr_stress_tester_v2.70.exe.zip" target="_blank" rel="noopener">这里</a>下载<br><strong>注意：使用该工具时，需要将设备切换到Serial Download模式</strong></p>
<img src="/芯片方案/imx6/imx6ull方案研究_软件篇/DDR校准步骤.png"></li>
<li>经过一段时间的校准后会生成校准数据，将校准参数写入到基础配置文件<img src="/芯片方案/imx6/imx6ull方案研究_软件篇/DDR校准结果.png"></li>
<li>重新加载配置文件，进行压力测试，如果测试成功则可以将配置文件导入到uboot里<br><em>导入方法：手工对照一个一个复制，也可以用编辑工具编辑好再复制，总之只能手工</em></li>
</ol>
<h2 id="内存大小自适应"><a href="#内存大小自适应" class="headerlink" title="内存大小自适应"></a>内存大小自适应</h2><p>前面讲的内存参数配置里包含了大小，但这个大小只涉及内存控制器，相应的参数会填充到内存控制器里。<br>imx6的默认uboot代码，识别内存大小的方法是直接从控制器里读取配置，如果设备的内存大小是固定的，不同大小的内存对应不同的软件版本，这种方法是可行啊，但是…</p>
<p>我们希望一个软件版本能适应不同内存大小，这要怎么做呢？</p>
<ol>
<li>首先要确认设备需要使用的最大内存是多少，内存大小参数按照最大的来填写</li>
<li>uboot代码里使用uboot官方的做法，使用get_ram_size去获取内存大小</li>
<li>kernel设备树里的内存配置，使用最大值</li>
</ol>
<p>原理说明（感兴趣的可以阅读）：</p>
<ul>
<li>写入到内存控制器的参数(片选、bank数、位宽、行列地址等)会控制内存访问时发出正确的读写时序，细节可查看CPU datasheet；</li>
<li>不同容量同类型的DDR，一般只有行地址（Row Address）不同（<em>有兴趣的可以看DDR手册</em>），其他参数是一致的；</li>
<li>CPU访问内存时，imx6有2种地址映射方法（从高地址到低地址）：<ul>
<li>BANK-ROW-COL（bank interleaving off）</li>
<li>ROW-BANK-COL（bank interleaving on）<br><em>详情可查看CPU datasheet</em></li>
</ul>
</li>
<li>当bank interleaving on里，行地址(ROW)被映射到最高位，访问高地址和低地址对就的时序是一样的</li>
</ul>
<p>从原理可以看出，内存大小自适应是有前提的：</p>
<ul>
<li>打开bank interleaving，在MMDC_MDMISC寄存器中（官方默认配置是打开的）</li>
<li>需要使用相同类型的内存：位宽bank数、列地址大小、页大小相同，关键的时序参数也要相同</li>
</ul>
<h1 id="uboot下硬件接口适配"><a href="#uboot下硬件接口适配" class="headerlink" title="uboot下硬件接口适配"></a>uboot下硬件接口适配</h1><p>官方默认uboot代码可以驱动串口、网口、USB、TF卡、I2C等，在新的硬件下，这些接口需要重新进行适配</p>
<h2 id="串口适配"><a href="#串口适配" class="headerlink" title="串口适配"></a>串口适配</h2><p>   每1步：需要正确配置串口引脚，由setup_iomux_uart函数完成 </p>
   <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">setup_iomux_uart</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	imx_iomux_v3_setup_multiple_pads(uart1_pads, ARRAY_SIZE(uart1_pads));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
   <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">iomux_v3_cfg_t</span> <span class="keyword">const</span> uart1_pads[] = &#123;</span><br><span class="line">	MX6_PAD_UART1_TX_DATA__UART1_DCE_TX | MUX_PAD_CTRL(UART_PAD_CTRL),</span><br><span class="line">	MX6_PAD_UART1_RX_DATA__UART1_DCE_RX | MUX_PAD_CTRL(UART_PAD_CTRL),</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>   <em>注：请确保使用的引脚配置没有被其他代码重新配置</em></p>
<p>   第2步：配置软件需要使用的串口，在全局配置文件中</p>
   <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> CONFIG_MXC_UART</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> CONFIG_MXC_UART_BASE		UART1_BASE</span></span><br></pre></td></tr></table></figure>
<h2 id="网口适配"><a href="#网口适配" class="headerlink" title="网口适配"></a>网口适配</h2><p>   这里说的网口是指CPU自带的网口<br>   第1步：根据硬件设计，确认选择哪个网口（imx6ull最多有2个网口，一般会选择0），在全局配置文件中</p>
<p>   第2步：根据硬件设计，确认选择的PHY接口类型（通常会有RMII）以及PHY的设备地址（需要查看PHY芯片手册）</p>
<p>   第3步：选择PHY芯片驱动</p>
   <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_CMD_NET</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> CONFIG_CMD_PING</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> CONFIG_CMD_DHCP</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> CONFIG_CMD_MII</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> CONFIG_FEC_MXC</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> CONFIG_MII</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> CONFIG_FEC_ENET_DEV		0 <span class="comment">//选择网口0</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> (CONFIG_FEC_ENET_DEV == 0)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> IMX_FEC_BASE			ENET_BASE_ADDR</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> CONFIG_FEC_MXC_PHYADDR          0x0 <span class="comment">//PHY的设备地址</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> CONFIG_FEC_XCV_TYPE             RMII</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">elif</span> (CONFIG_FEC_ENET_DEV == 1)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> IMX_FEC_BASE			ENET2_BASE_ADDR</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> CONFIG_FEC_MXC_PHYADDR		0x1</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> CONFIG_FEC_XCV_TYPE		RMII</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> CONFIG_ETHPRIME			<span class="meta-string">"FEC"</span> <span class="comment">//网口名称，无关紧要</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> CONFIG_PHYLIB  <span class="comment">//表示需要使用外部PHY，相应的驱动代码会编译</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> CONFIG_PHY_SMSC  <span class="comment">//硬件使用的PHY厂家，表示使用SMSC的PHY，相应的SMSC的PHY驱动会被编译</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure>
<p>   <em>注：如果硬件使用的PHY，uboot代码中没对应的驱动，可以尝试使用通用驱动，即：只定义CONFIG_PHYLIB，一般通用驱动可以用于决大部分硬件的驱动</em></p>
<p>   第4步：硬件引脚复用配置，由setup_iomux_fec函数完成</p>
   <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">setup_iomux_fec</span><span class="params">(<span class="keyword">int</span> fec_id)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (fec_id == <span class="number">0</span>)&#123;</span><br><span class="line">		imx_iomux_v3_setup_multiple_pads(fec1_pads,</span><br><span class="line">						 ARRAY_SIZE(fec1_pads));</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* Reset the PHY */</span></span><br><span class="line">        gpio_direction_output(IMX_GPIO_NR(<span class="number">5</span>, <span class="number">9</span>) , <span class="number">0</span>);</span><br><span class="line">        mdelay(<span class="number">100</span>);</span><br><span class="line">        gpio_direction_output(IMX_GPIO_NR(<span class="number">5</span>, <span class="number">9</span>) , <span class="number">1</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">		imx_iomux_v3_setup_multiple_pads(fec2_pads,</span><br><span class="line">						 ARRAY_SIZE(fec2_pads));</span><br><span class="line">        <span class="comment">/* Reset the PHY */</span></span><br><span class="line">        gpio_direction_output(IMX_GPIO_NR(<span class="number">5</span>, <span class="number">6</span>) , <span class="number">0</span>);</span><br><span class="line">        mdelay(<span class="number">100</span>);</span><br><span class="line">        gpio_direction_output(IMX_GPIO_NR(<span class="number">5</span>, <span class="number">6</span>) , <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>   正确配置fec1_pads(或fec2_pads)即可</p>
<p>   <strong>注意：setup_iomux_fec包含了PHY复位的控制，相应的GPIO也要配置正确</strong></p>
<h2 id="USB适配"><a href="#USB适配" class="headerlink" title="USB适配"></a>USB适配</h2><p>   第1步：配置实际使用的USB接口数量<br>   第2步：硬件是否使用OTG功能，使用OTG功能时，需要正确配置ID引脚</p>
   <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> CONFIG_USB_MAX_CONTROLLER_COUNT 2 <span class="comment">//硬件使用几个USB接口</span></span></span><br></pre></td></tr></table></figure>
   <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">iomux_v3_cfg_t</span> <span class="keyword">const</span> usb_otg_pads[] = &#123;</span><br><span class="line">	MX6_PAD_GPIO1_IO00__ANATOP_OTG1_ID | MUX_PAD_CTRL(OTG_ID_PAD_CTRL),</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="TF卡适配"><a href="#TF卡适配" class="headerlink" title="TF卡适配"></a>TF卡适配</h2><p>按照正常的设计i.MX6 ULL的TF卡都会接在USDHC1上，一般不会有什么问题</p>
<p>需要注意一点：官方默认代码有USDHC的复位控制，实际硬件如果不使用复位功能，需要去掉相应的代码</p>
<h2 id="I2C适配"><a href="#I2C适配" class="headerlink" title="I2C适配"></a>I2C适配</h2><p>uboot下一般不需要使用I2C功能，如果确实需要使用，要进行以下几点适配</p>
<ul>
<li>确认使用哪路I2C（i.MX6 ULL可提供多路I2C），在主配置文件中</li>
<li>正确配置引脚复用</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> CONFIG_SYS_I2C_MXC_I2C1		<span class="comment">/* enable I2C bus 1 */</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> CONFIG_SYS_I2C_MXC_I2C2		<span class="comment">/* enable I2C bus 2 */</span></span></span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">struct</span> <span class="title">i2c_pads_info</span> <span class="title">i2c_pad_info1</span> = &#123;</span></span><br><span class="line">	.scl = &#123;</span><br><span class="line">		.i2c_mode =  MX6_PAD_UART4_TX_DATA__I2C1_SCL | PC,</span><br><span class="line">		.gpio_mode = MX6_PAD_UART4_TX_DATA__GPIO1_IO28 | PC,</span><br><span class="line">		.gp = IMX_GPIO_NR(<span class="number">1</span>, <span class="number">28</span>),</span><br><span class="line">	&#125;,</span><br><span class="line">	.sda = &#123;</span><br><span class="line">		.i2c_mode = MX6_PAD_UART4_RX_DATA__I2C1_SDA | PC,</span><br><span class="line">		.gpio_mode = MX6_PAD_UART4_RX_DATA__GPIO1_IO29 | PC,</span><br><span class="line">		.gp = IMX_GPIO_NR(<span class="number">1</span>, <span class="number">29</span>),</span><br><span class="line">	&#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><em>I2C引脚配置中有GPIO的配置，作用：I2C初化时会尝试检测总线是否可以正常工作，需要用到GPIO模式</em></p>
<h1 id="linux系统下接口调试"><a href="#linux系统下接口调试" class="headerlink" title="linux系统下接口调试"></a>linux系统下接口调试</h1><p>linux系统下的接口调试主要通过配置设备树来完成，设备树需要与代码匹配（设备树中的东西在kernel代码中是有对应的处理流程的）</p>
<p>涉及的内容比较多，这里只做简单描述。</p>
<h2 id="设备树裁剪"><a href="#设备树裁剪" class="headerlink" title="设备树裁剪"></a>设备树裁剪</h2><p>默认设备树代码中添加了许多设备，需要根据实际的硬件进行裁剪，比如：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">backlight &#123;</span><br><span class="line">	compatible = <span class="string">"pwm-backlight"</span>;</span><br><span class="line">	pwms = &lt;&amp;pwm1 <span class="number">0</span> <span class="number">5000000</span>&gt;;</span><br><span class="line">	brightness-levels = &lt;<span class="number">0</span> <span class="number">4</span> <span class="number">8</span> <span class="number">16</span> <span class="number">32</span> <span class="number">64</span> <span class="number">128</span> <span class="number">255</span>&gt;;</span><br><span class="line">	<span class="keyword">default</span>-brightness-level = &lt;<span class="number">6</span>&gt;;</span><br><span class="line">	status = <span class="string">"disabled"</span>; <span class="comment">//设置成disabled，则不会注册到系统中，但为了代码的简洁性，可以将整个backlight删除</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">pxp_v4l2 &#123;</span><br><span class="line">	compatible = <span class="string">"fsl,imx6ul-pxp-v4l2"</span>, <span class="string">"fsl,imx6sx-pxp-v4l2"</span>, <span class="string">"fsl,imx6sl-pxp-v4l2"</span>;</span><br><span class="line">	status = <span class="string">"disabled"</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="串口"><a href="#串口" class="headerlink" title="串口"></a>串口</h2><p>包含2部分</p>
<ol>
<li><p>注册串口设计（当然也是修改设备树），比如下面的配置是添加注册2个串口</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&amp;uart1 &#123;</span><br><span class="line">	pinctrl-names = <span class="string">"default"</span>;</span><br><span class="line">	pinctrl<span class="number">-0</span> = &lt;&amp;pinctrl_uart1&gt;;<span class="comment">//UART1使用的引脚，需要正确设置，从设备树已有代码很容易看出怎么使用</span></span><br><span class="line">	status = <span class="string">"okay"</span>; <span class="comment">//表示将uart1注册到系统中</span></span><br><span class="line">&#125;;</span><br><span class="line">&amp;uart2 &#123;</span><br><span class="line">	pinctrl-names = <span class="string">"default"</span>;</span><br><span class="line">	pinctrl<span class="number">-0</span> = &lt;&amp;pinctrl_uart2&gt;;<span class="comment">//UART2使用的引脚</span></span><br><span class="line">	fsl,uart-has-rtscts; <span class="comment">//打开流控功能</span></span><br><span class="line">	<span class="comment">/* for DTE mode, add below change */</span></span><br><span class="line">	<span class="comment">/* fsl,dte-mode; */</span></span><br><span class="line">	<span class="comment">/* pinctrl-0 = &lt;&amp;pinctrl_uart2dte&gt;; */</span></span><br><span class="line">	status = <span class="string">"okay"</span>;<span class="comment">//表示将uart2注册到系统中</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>指定系统使用哪个串口作为标准输出口（输出kernel打印）</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">chosen &#123;</span><br><span class="line">	<span class="built_in">stdout</span>-path = &amp;uart1;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>​</p>
</li>
</ol>
<h2 id="网口驱动"><a href="#网口驱动" class="headerlink" title="网口驱动"></a>网口驱动</h2><p> 网口驱动主要是在PHY的适配上，细节如下：</p>
<ul>
<li>看设备树中，默认代码将mdio总线注册在fec2（总共有fec1和fec2），不合常理，一般应该注册在第一个（fec1）；</li>
<li>阅读代码，代码设计将mdio注册在eth0上，代码中按照probe顺序注册网口，因为在设备树中fec2在fec1前面，因此fec2注册成eth0，fec1注册成eth1</li>
<li>为方便常理认知，以及后续单网口与双网口兼容，将fec1放在fec2前面</li>
</ul>
<p>针对Y2系统，支持2个网口，但只有一个MDIO总线引脚，如果需要使用Y2的双网口功能，需要软件特别处理，官方代码设计已经有处理，但需要做简单修改，原因及修改如下：</p>
<ul>
<li>硬件设计中phy的时钟由CPU提供；</li>
<li>MDIO总线只能注册在第1个网口上（比如注册在fec1上）</li>
<li>初始化fec1时，fec2没有打开，对应的phy没有时钟，因此不能自动探测到phy型号；</li>
<li>设备树中需要指定fec2的phy ID</li>
</ul>
<p>修改示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">mdio &#123;</span><br><span class="line">	#address-cells = &lt;1&gt;;</span><br><span class="line">	#size-cells = &lt;0&gt;;</span><br><span class="line"></span><br><span class="line">	ethphy0: ethernet-phy@0 &#123;</span><br><span class="line">		compatible = &quot;ethernet-phy-ieee802.3-c22&quot;;</span><br><span class="line">		reg = &lt;0&gt;;</span><br><span class="line">	&#125;;</span><br><span class="line"></span><br><span class="line">	ethphy1: ethernet-phy@1 &#123;</span><br><span class="line">		compatible = &quot;ethernet-phy-id0007.c0f1&quot;;</span><br><span class="line">		reg = &lt;1&gt;;</span><br><span class="line">	&#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="SD-EMMC驱动"><a href="#SD-EMMC驱动" class="headerlink" title="SD/EMMC驱动"></a>SD/EMMC驱动</h2><p>默认代码运行时，sd插入会有错误打印</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mmc0: tuning execution failed</span><br><span class="line">mmc0: error -5 whilst initialising SD card</span><br></pre></td></tr></table></figure>
<p>需要修改设备树，添加“no-1-8-v”属性</p>
<h2 id="USB"><a href="#USB" class="headerlink" title="USB"></a>USB</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&amp;usbotg1 &#123;</span><br><span class="line">	dr_mode = <span class="string">"otg"</span>; <span class="comment">//注意模式选择</span></span><br><span class="line">	srp-disable; <span class="comment">//OTG模式里需要这些选项</span></span><br><span class="line">	hnp-disable;</span><br><span class="line">	adp-disable;</span><br><span class="line">	status = <span class="string">"okay"</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">&amp;usbotg2 &#123;</span><br><span class="line">	dr_mode = <span class="string">"host"</span>;</span><br><span class="line">	disable-over-current; <span class="comment">//关闭过流检测，硬件一般不设计这个功能，如果硬件设计了，则需要正配置</span></span><br><span class="line">	status = <span class="string">"okay"</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">&amp;usbphy1 &#123;</span><br><span class="line">	tx-d-cal = &lt;<span class="number">0x5</span>&gt;;<span class="comment">//D_CAL，用于补偿电路USB电流的损耗，值越大补偿越多</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">&amp;usbphy2 &#123;</span><br><span class="line">	tx-d-cal = &lt;<span class="number">0x5</span>&gt;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</div><div class="tags"><a href="/tags/imx6/">imx6</a></div><div class="post-share"><div class="bdsharebuttonbox"><span style="float:left;line-height: 28px;height: 28px;font-size:16px;font-weight:blod">分享到：</span><a href="#" data-cmd="more" class="bds_more"></a><a href="#" data-cmd="mshare" title="分享到一键分享" class="bds_mshare"></a><a href="#" data-cmd="fbook" title="分享到Facebook" class="bds_fbook"></a><a href="#" data-cmd="twi" title="分享到Twitter" class="bds_twi"></a><a href="#" data-cmd="linkedin" title="分享到linkedin" class="bds_linkedin"></a><a href="#" data-cmd="youdao" title="分享到有道云笔记" class="bds_youdao"></a><a href="#" data-cmd="evernotecn" title="分享到印象笔记" class="bds_evernotecn"></a><a href="#" data-cmd="weixin" title="分享到微信" class="bds_weixin"></a><a href="#" data-cmd="qzone" title="分享到QQ空间" class="bds_qzone"></a><a href="#" data-cmd="tsina" title="分享到新浪微博" class="bds_tsina"></a></div></div><div class="post-nav"><a href="/Linux系统/linux串口驱动/" class="pre">linux串口驱动</a><a href="/芯片方案/imx6/imx6ull方案研究_硬件篇/" class="next">i.MX 6ULL研究笔记_硬件篇</a></div><div id="comments"></div></div></div></div><div class="layout-r"><div id="sidebar"><div class="search-pla"></div><div id="toc" class="widget"><div class="widget-title"><i class="fa fa-fei">文章目录</i></div><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#搭建编译工程"><span class="toc-text">搭建编译工程</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#源码获取"><span class="toc-text">源码获取</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#工具链获取"><span class="toc-text">工具链获取</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#编译-amp-移植"><span class="toc-text">编译&amp;移植</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#uboot编译-amp-移植"><span class="toc-text">uboot编译&amp;移植</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#kernel编译-amp-移植"><span class="toc-text">kernel编译&amp;移植</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#rootfs编译"><span class="toc-text">rootfs编译</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#CPU超频方法"><span class="toc-text">CPU超频方法</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#实测"><span class="toc-text">实测</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#内存配置"><span class="toc-text">内存配置</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#内存配置参数"><span class="toc-text">内存配置参数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#内存参数校准"><span class="toc-text">内存参数校准</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#内存大小自适应"><span class="toc-text">内存大小自适应</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#uboot下硬件接口适配"><span class="toc-text">uboot下硬件接口适配</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#串口适配"><span class="toc-text">串口适配</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#网口适配"><span class="toc-text">网口适配</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#USB适配"><span class="toc-text">USB适配</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#TF卡适配"><span class="toc-text">TF卡适配</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#I2C适配"><span class="toc-text">I2C适配</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#linux系统下接口调试"><span class="toc-text">linux系统下接口调试</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#设备树裁剪"><span class="toc-text">设备树裁剪</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#串口"><span class="toc-text">串口</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#网口驱动"><span class="toc-text">网口驱动</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SD-EMMC驱动"><span class="toc-text">SD/EMMC驱动</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#USB"><span class="toc-text">USB</span></a></li></ol></li></ol></div><div class="widget"><div class="widget-title"><i class="fa fa-xie"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/芯片方案/mdm9x07/QMI 拨号&网口/">QMI 拨号&网口</a></li><li class="post-list-item"><a class="post-list-link" href="/Linux系统/linux USB host 驱动/">linux USB host驱动</a></li><li class="post-list-item"><a class="post-list-link" href="/Linux系统/linux USB gadget 驱动/">linux gadget 驱动</a></li><li class="post-list-item"><a class="post-list-link" href="/Linux系统/cmdline初始流程/">cmdline初始流程</a></li><li class="post-list-item"><a class="post-list-link" href="/Linux系统/linux根文件系统挂载过程/">linux根文件系统挂载过程</a></li><li class="post-list-item"><a class="post-list-link" href="/芯片方案/mdm9x07/mdm9x07内存使用分析/">mdm9x07内存使用分析</a></li><li class="post-list-item"><a class="post-list-link" href="/allegro/allegro/">allegro/allegro</a></li><li class="post-list-item"><a class="post-list-link" href="/深度学习/TensorFlow笔记/">TensorFlow笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/深度学习/MTCNN tensorflow实现/">MTCNN tensorflow实现</a></li><li class="post-list-item"><a class="post-list-link" href="/深度学习/Caffe笔记/">Caffe笔记</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-gui"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/ARM架构/">ARM架构</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux内核/">linux内核</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/uboot/">uboot</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/杂项/">杂项</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/深度学习/">深度学习</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/芯片方案/">芯片方案</a><span class="category-list-count">4</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-biao"> 标签</i></div><div class="tagcloud"><a href="/tags/中断/" style="font-size: 15px;">中断</a> <a href="/tags/cmdline/" style="font-size: 15px;">cmdline</a> <a href="/tags/USB/" style="font-size: 15px;">USB</a> <a href="/tags/rootfs/" style="font-size: 15px;">rootfs</a> <a href="/tags/hexo/" style="font-size: 15px;">hexo</a> <a href="/tags/caffe2/" style="font-size: 15px;">caffe2</a> <a href="/tags/MTCNN/" style="font-size: 15px;">MTCNN</a> <a href="/tags/tensorflow/" style="font-size: 15px;">tensorflow</a> <a href="/tags/arm/" style="font-size: 15px;">arm</a> <a href="/tags/uboot/" style="font-size: 15px;">uboot</a> <a href="/tags/linux驱动/" style="font-size: 15px;">linux驱动</a> <a href="/tags/串口/" style="font-size: 15px;">串口</a> <a href="/tags/tty/" style="font-size: 15px;">tty</a> <a href="/tags/TensorFlow/" style="font-size: 15px;">TensorFlow</a> <a href="/tags/环境搭建/" style="font-size: 15px;">环境搭建</a> <a href="/tags/芯片资料/" style="font-size: 15px;">芯片资料</a> <a href="/tags/mdm9x07/" style="font-size: 15px;">mdm9x07</a> <a href="/tags/imx6/" style="font-size: 15px;">imx6</a> <a href="/tags/rmmnet/" style="font-size: 15px;">rmmnet</a> <a href="/tags/QMI/" style="font-size: 15px;">QMI</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-archive"> 归档</i></div><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">七月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">五月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">四月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">三月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">一月 2018</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-you"> 友情链接</i></div><ul></ul><a href="http://www.example1.com/" title="site-name1" target="_blank">site-name1</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div></div><a id="totop" href="#top"></a><div id="footer"><div class="footer-info"><p><a href="/baidusitemap.xml">Baidu Site Haritası</a> |  <a href="/atom.xml">订阅</a> |  <a href="/about/">关于</a></p><p>本站总访问量：<i id="busuanzi_container_site_pv"><i id="busuanzi_value_site_pv"></i></i>次</p><p><span> Copyright &copy;<a href="/." rel="nofollow">wzhchen.</a></span><span> Theme by<a rel="nofollow" target="_blank" href="https://github.com/chaooo/hexo-theme-BlueLake"> BlueLake.</a></span><span> Count by<a href="http://busuanzi.ibruce.info/"> busuanzi.</a></span><span> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a></span></p></div></div></div><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><script type="text/javascript" src="/js/search.json.js?v=2.0.1"></script><script type="text/javascript" src="/js/toctotop.js?v=2.0.1" async></script><script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":["mshare","weixin","tsina","qzone","linkedin","fbook","twi","print","renren","sqq","evernotecn","bdysc","tqq","tqf","bdxc","kaixin001","tieba","douban","bdhome","thx","ibaidu","meilishuo","mogujie","diandian","huaban","duitang","hx","fx","youdao","sdo","qingbiji","people","xinhua","mail","isohu","yaolan","wealink","ty","iguba","h163","copy"],"bdPic":"","bdStyle":"1","bdSize":"16"},"share":{},"image":{"viewList":["tsina","qzone","weixin","fbook","twi","linkedin","youdao","evernotecn","mshare"],"viewText":"分享到：","viewSize":"16"},"selectShare":{"bdContainerClass":null,"bdSelectMiniList":["tsina","qzone","weixin","fbook","twi","linkedin","youdao","evernotecn","mshare"]}};with(document)0[(getElementsByTagName('head')[0]||head).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
</script></body></html>